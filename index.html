<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANANA HUB KEY</title>
    <style>
        body { margin:0; background:#0a0a0a; color:#FFE135; font-family: sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden; }
        .box { background:#111; padding:40px; border:3px solid #FFE135; border-radius:20px; text-align:center; width:350px; box-shadow:0 0 50px rgba(255, 225, 53, 0.2); }
        .key { font-size:26px; font-weight:bold; color:#fff; background:#000; padding:20px; margin:20px 0; border-radius:10px; border:2px dashed #FFE135; letter-spacing: 2px; }
        button { background:#FFE135; border:none; padding:15px; width:100%; font-weight:900; cursor:pointer; border-radius:10px; font-size:16px; margin-top: 10px; }
        .loader { border: 4px solid #333; border-top: 4px solid #FFE135; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; flex-direction:column; z-index:999; }
    </style>
</head>
<body>
    <div class="box">
        <h2 style="margin:0;">üçå BANANA HUB</h2>
        <div style="font-size:11px; color:#555;">HWID: <span id="hwid-show">...</span></div>
        <div id="key-display" class="key">LOADING...</div>
        <button onclick="copyKey()">COPY KEY</button>
        <div style="margin-top:15px; color:#888;">Key h·∫øt h·∫°n sau: <span id="countdown" style="color:red; font-weight:bold;">10</span>s</div>
    </div>

    <div class="overlay" id="redirect-screen">
        <div class="loader"></div>
        <h3 style="color:#fff;">H·∫æT GI·ªú!</h3>
        <p style="color:#aaa;">ƒêang t·∫°o link Link4M m·ªõi...</p>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const hwid = params.get('hwid');
        document.getElementById('hwid-show').innerText = hwid || "MISSING";

        async function init() {
            if(!hwid) {
                document.getElementById('key-display').innerText = "V√ÄO T·ª™ GAME!";
                document.getElementById('key-display').style.fontSize = "18px";
                return;
            }

            try {
                // 1. L·∫•y Key
                const res = await fetch(`/api/verify?hwid=${hwid}&nocache=${Date.now()}`);
                const data = await res.json();
                document.getElementById('key-display').innerText = data.key;
                
                // 2. ƒê·∫øm ng∆∞·ª£c
                let timeLeft = data.ttl || 10;
                const cd = document.getElementById('countdown');

                const timer = setInterval(() => {
                    timeLeft--;
                    cd.innerText = timeLeft;
                    if(timeLeft <= 0) {
                        clearInterval(timer);
                        getLink4M(); // H·∫øt gi·ªù -> G·ªçi h√†m l·∫•y link m·ªõi
                    }
                }, 1000);

            } catch(e) { console.log(e); }
        }

        async function getLink4M() {
            document.getElementById('redirect-screen').style.display = 'flex';
            try {
                // G·ªçi API l·∫•y link Link4M
                const res = await fetch(`/api/verify?hwid=${hwid}&shorten=true&nocache=${Date.now()}`);
                const data = await res.json();
                
                if(data.status === "success" && data.url) {
                    window.location.href = data.url; // Chuy·ªÉn h∆∞·ªõng ngay l·∫≠p t·ª©c
                } else {
                    alert("L·ªói t·∫°o link! Vui l√≤ng F5.");
                    location.reload();
                }
            } catch(e) {
                alert("M·∫•t k·∫øt n·ªëi!");
            }
        }

        init();
        function copyKey() {
            navigator.clipboard.writeText(document.getElementById('key-display').innerText);
            alert("ƒê√£ Copy Key!");
        }
    </script>
</body>
</html>
