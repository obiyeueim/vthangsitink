<script>
    const urlParams = new URLSearchParams(window.location.search);
    let hwid = (urlParams.get('hwid') || "UNKNOWN").trim();
    document.getElementById('hwid-val-display').innerText = hwid;

    function generate() {
        setTimeout(() => {
            document.getElementById('loading-area').style.display = 'none';
            document.getElementById('key-val').style.display = 'block';
            document.getElementById('copy-btn').style.display = 'block';
            updateKey();
        }, 2000);
    }

    function updateKey() {
        const now = Date.now();
        // CHỈNH Ở ĐÂY: 30000ms = 30 giây
        const timeStep = Math.floor(now / 30000); 
        const secret = "BANANAVIP";
        const generatedKey = "BNN_" + btoa(hwid + timeStep + secret).substring(0, 12).toUpperCase();
        
        document.getElementById('key-val').innerText = generatedKey;
        
        // Tính giây còn lại trong chu kỳ 30s
        const secondsLeft = 30 - Math.floor((now % 30000) / 1000);
        document.getElementById('timer').innerText = "Mã sẽ đổi sau: " + secondsLeft + " giây";
    }

    setInterval(() => {
        if(document.getElementById('key-val').style.display === 'block') {
            updateKey();
        }
    }, 1000);

    function copyKey() {
        const key = document.getElementById('key-val').innerText;
        navigator.clipboard.writeText(key);
        const btn = document.getElementById('copy-btn');
        btn.innerText = "✅ ĐÃ SAO CHÉP";
        btn.style.background = "#00ff00";
        setTimeout(() => {
            btn.innerText = "SAO CHÉP MÃ";
            btn.style.background = "#FFD700";
        }, 2000);
    }
    generate();
</script>
