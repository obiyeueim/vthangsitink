<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANANA HUB - HWID CHECK</title>
    <style>
        body { margin:0; background:#111; color:#FFE135; font-family: sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; }
        .box { background:#000; padding:30px; border:2px solid #FFE135; border-radius:15px; text-align:center; width:350px; }
        .key { font-size:24px; font-weight:bold; color:#fff; background:#222; padding:15px; margin:20px 0; border-radius:10px; border:1px dashed #FFE135; letter-spacing: 2px; }
        button { background:#FFE135; border:none; padding:15px; width:100%; font-weight:bold; font-size:16px; cursor:pointer; border-radius:8px; }
        button:hover { background:#fff; }
        .info { font-size:12px; color:#666; margin-top:10px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>üçå BANANA DEVICE KEY</h2>
        <div style="font-size: 11px; color: #888;">YOUR HWID: <span id="hwid-show">...</span></div>
        
        <div id="key-display" class="key">WAITING...</div>
        
        <button onclick="copyKey()">COPY KEY</button>
        <div class="info">Key changes every 10s (<span id="time">10</span>s)</div>
    </div>

    <script>
        // 1. L·∫•y HWID t·ª´ URL (?hwid=xxx)
        const params = new URLSearchParams(window.location.search);
        const hwid = params.get('hwid');

        document.getElementById('hwid-show').innerText = hwid || "UNKNOWN";

        async function getKey() {
            if(!hwid) {
                document.getElementById('key-display').innerText = "NO HWID DETECTED";
                document.getElementById('key-display').style.color = "red";
                document.getElementById('key-display').style.fontSize = "16px";
                return;
            }

            try {
                // G·ª≠i k√®m HWID l√™n Server ƒë·ªÉ l·∫•y key ri√™ng
                const res = await fetch(`/api/verify?hwid=${hwid}&nocache=${Date.now()}`);
                const data = await res.json();

                if(data.error) {
                     document.getElementById('key-display').innerText = "ERROR";
                } else {
                    document.getElementById('key-display').innerText = data.key;
                    
                    // ƒê·∫øm ng∆∞·ª£c
                    let t = data.ttl;
                    const timer = document.getElementById('time');
                    if(window.cd) clearInterval(window.cd);
                    window.cd = setInterval(() => {
                        t--; timer.innerText = t;
                        if(t<=0) { clearInterval(window.cd); getKey(); }
                    }, 1000);
                }
            } catch(e) { console.log(e); }
        }
        getKey();

        function copyKey() {
            navigator.clipboard.writeText(document.getElementById('key-display').innerText);
            alert("Copied!");
        }
    </script>
</body>
</html>
