<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BANANA HUB - CARTOON EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* C√ÄI ƒê·∫∂T CHUNG */
        * { box-sizing: border-box; }
        body {
            margin: 0;
            /* N·ªÅn gradient v√†ng cam t∆∞∆°i s√°ng */
            background: linear-gradient(135deg, #FFD700, #FF8C00);
            font-family: 'Fredoka', sans-serif; /* Font ho·∫°t h√¨nh */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding: 20px;
        }

        /* H·ªòP CH·ª®A CH√çNH (KI·ªÇU V·ªé CHU·ªêI) */
        .main-card {
            background: #FFFBEA; /* M√†u kem s√°ng */
            width: 100%;
            max-width: 380px;
            padding: 30px;
            border-radius: 30px;
            /* Vi·ªÅn m√†u n√¢u ƒë·∫≠m ki·ªÉu ƒë·∫ßu qu·∫£ chu·ªëi */
            border: 5px solid #5C4033;
            text-align: center;
            /* B√≥ng ƒë·ªï t·∫°o chi·ªÅu s√¢u 3D */
            box-shadow: 0 15px 0 #C7A300, 0 25px 30px rgba(0,0,0,0.2);
            position: relative;
            transition: transform 0.3s ease;
        }
        .main-card:hover { transform: translateY(-5px); }

        /* ·∫¢NH MEME ƒê·ªòNG */
        .meme-gif {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #FFD700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: -60px; /* Nh√¥ l√™n kh·ªèi h·ªôp */
            background: #fff;
        }

        h2 {
            margin: 15px 0 5px;
            color: #5C4033;
            font-size: 28px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #FFD700;
        }

        /* TH·∫∫ HWID */
        .hwid-badge {
            display: inline-block;
            background: #FFD700;
            color: #5C4033;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* KHUNG HI·ªÇN TH·ªä KEY */
        .key-box-container {
            background: #2a2a2a;
            padding: 5px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .key {
            font-family: 'Courier New', monospace;
            font-size: 22px;
            font-weight: bold;
            color: #FFD700;
            background: #111;
            padding: 15px;
            border: 3px dashed #FFD700;
            border-radius: 12px;
            word-break: break-all;
        }

        /* N√öT B·∫§M 3D */
        .btn-copy {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            background: #FFD700;
            color: #5C4033;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            /* Hi·ªáu ·ª©ng n√∫t n·ªïi 3D */
            box-shadow: 0 6px 0 #C7A300;
            transition: all 0.1s;
            position: relative;
            top: 0;
        }
        .btn-copy:active {
            top: 6px;
            box-shadow: 0 0 0 #C7A300;
        }

        /* THANH ƒê·∫æM NG∆Ø·ª¢C */
        .timer-container { margin-top: 20px; }
        .progress-bg {
            height: 12px;
            background: #E0E0E0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 2px solid #5C4033;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF4444, #FFD700);
            width: 100%;
            transition: width 1s linear;
        }
        .timer-text { font-size: 14px; color: #5C4033; font-weight: bold; }
        #countdown { color: #FF4444; font-size: 18px; }

        /* M√ÄN H√åNH CH·ªú CHUY·ªÇN H∆Ø·ªöNG */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(92, 64, 51, 0.95); /* N√¢u t·ªëi */
            display: none;
            justify-content: center; align-items: center; flex-direction: column;
            z-index: 999; color: #FFD700;
        }
        .banana-loader {
            font-size: 50px;
            animation: spin 1s infinite linear;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="main-card">
        <img src="https://media.tenor.com/2Xy40aH9yG4AAAAi/banana-cat-crying.gif" class="meme-gif" alt="Banana Cat">
        <h2>üçå BANANA HUB</h2>
        <div class="hwid-badge">HWID: <span id="hwid-show">Checking...</span></div>

        <div class="key-box-container">
            <div id="key-display" class="key">LOADING...</div>
        </div>

        <button class="btn-copy" onclick="copyKey()">COPY KEY NGAY!</button>

        <div class="timer-container">
            <div class="progress-bg">
                <div class="progress-bar" id="progress"></div>
            </div>
            <div class="timer-text">Key h·∫øt h·∫°n sau: <span id="countdown">10</span>s</div>
        </div>
    </div>

    <div class="overlay" id="redirect-screen">
        <div class="banana-loader">üçå</div>
        <h3>H·∫æT GI·ªú R·ªíI!</h3>
        <p>ƒêang t·∫°o link m·ªõi...</p>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const hwid = params.get('hwid');
        document.getElementById('hwid-show').innerText = hwid ? hwid.substring(0, 15) + "..." : "MISSING";

        async function init() {
            if(!hwid) {
                document.getElementById('key-display').innerText = "V√ÄO T·ª™ GAME!";
                document.getElementById('key-display').style.color = "#FF4444";
                return;
            }

            try {
                // 1. L·∫•y Key t·ª´ Vercel
                const res = await fetch(`/api/verify?hwid=${hwid}&nocache=${Date.now()}`);
                const data = await res.json();
                document.getElementById('key-display').innerText = data.key;
                
                // 2. X·ª≠ l√Ω ƒë·∫øm ng∆∞·ª£c v√† thanh ti·∫øn tr√¨nh
                let maxTime = 10;
                let timeLeft = data.ttl || maxTime;
                
                const cdLabel = document.getElementById('countdown');
                const progressBar = document.getElementById('progress');

                const timer = setInterval(() => {
                    timeLeft--;
                    cdLabel.innerText = timeLeft;
                    
                    // C·∫≠p nh·∫≠t ƒë·ªô d√†i thanh ti·∫øn tr√¨nh
                    const percentage = (timeLeft / maxTime) * 100;
                    progressBar.style.width = percentage + "%";

                    if(timeLeft <= 0) {
                        clearInterval(timer);
                        progressBar.style.width = "0%";
                        getLink4M(); // H·∫øt gi·ªù -> ƒê√° sang Link4M
                    }
                }, 1000);

            } catch(e) {
                document.getElementById('key-display').innerText = "L·ªñI M·∫†NG";
            }
        }

        async function getLink4M() {
            document.getElementById('redirect-screen').style.display = 'flex';
            try {
                // G·ªçi API l·∫•y link r√∫t g·ªçn
                const res = await fetch(`/api/verify?hwid=${hwid}&shorten=true&nocache=${Date.now()}`);
                const data = await res.json();
                
                if(data.status === "success" && data.url) {
                    window.location.href = data.url; 
                } else {
                    // Fallback n·∫øu l·ªói
                    window.location.href = data.url || window.location.href;
                }
            } catch(e) {
                location.reload();
            }
        }

        init();
        
        function copyKey() {
            const keyText = document.getElementById('key-display').innerText;
            if(keyText.includes("...") || keyText.includes("L·ªñI")) return;
            navigator.clipboard.writeText(keyText);
            const btn = document.querySelector('.btn-copy');
            btn.innerText = "ƒê√É COPY! üçå";
            setTimeout(() => btn.innerText = "COPY KEY NGAY!", 2000);
        }
    </script>
</body>
</html>
