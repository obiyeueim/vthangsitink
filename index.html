<script>
    const hwid = new URLSearchParams(window.location.search).get('hwid') || "UNKNOWN";
    const secret = "BANANAVIP";

    function refresh() {
        const now = Date.now();
        
        // CHU KỲ 10 GIÂY: Ép số nguyên tuyệt đối từ giây thực tế
        const step = Math.floor(now / 10000); 
        
        // TẠO MÃ: Kết hợp HWID + Bước thời gian + Secret
        // Thêm step.toString() để đảm bảo nội dung thay đổi mỗi 10s
        const rawString = hwid.trim() + step.toString() + secret;
        const newKey = "BNN_" + btoa(rawString).substring(0, 12).toUpperCase();
        
        const keyDisplay = document.getElementById('key-display');
        const timerDisplay = document.getElementById('timer');
        const progress = document.getElementById('progress');

        // KIỂM TRA VÀ CẬP NHẬT (Cưỡng chế ghi đè)
        if (keyDisplay.innerText !== newKey) {
            keyDisplay.innerText = newKey;
            
            // Hiệu ứng nháy màu báo hiệu mã đã đổi
            keyDisplay.style.color = "#00ff00";
            setTimeout(() => { keyDisplay.style.color = "#ffffff"; }, 500);
            console.log("Mã mới đã nhảy: ", newKey);
        }

        // Đếm ngược từ 10 về 1
        const left = 10 - Math.floor((now % 10000) / 1000);
        timerDisplay.innerText = "REFRESH IN: " + left + "S";
        
        // Thanh progress chạy mượt theo thời gian thực
        if (progress) {
            progress.style.width = (left / 10) * 100 + "%";
        }
    }

    // Chạy kiểm tra liên tục mỗi 0.5 giây để không bỏ lỡ khoảnh khắc đổi mã
    setInterval(refresh, 500);
    refresh();

    function copy() {
        const text = document.getElementById('key-display').innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.getElementById('copy-btn');
            btn.innerText = "✅ COPIED!";
            setTimeout(() => { btn.innerText = "COPY ACCESS KEY"; }, 1000);
        });
    }
</script>
